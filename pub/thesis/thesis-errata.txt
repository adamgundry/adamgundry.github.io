Errata for the final accepted version of

    Type Inference, Haskell and Dependent Types
    Adam Michael Gundry
    PhD thesis, 2013

9th August 2014

Please report any further errors to adam (at) well (dash) typed (dot) com.


1. Pruning is not most general

In the description of higher-order pattern unification, the final rule
for pruning given on page 72,

    prune V Î” ts â†¦ Î”'   fv^rig(s) âŠ„ V
    ----------------------------------
    prune V (Î”,x:S) (ts,s) â†¦ Î”'

does not lead to most general solutions.  For example, consider

    Î± : ğ”¹, Î² : ((ğ”¹ â†’ ğ”¹) â†’ ğ”¹) â†’ ğ”¹  |   x : ğ”¹  âŠ¢  Î± â‰ˆ Î² (Î» f. f x) : ğ”¹

Then pruning ğ”¹ is successful and the rule allows the derivation of

    prune âˆ… (x:ğ”¹) (Î» f. f x) â†¦ .

since fv^rig(Î» f. f x) = {x}, but this loses the solution

   Î² = Î» k. k (Î» _. Î±).

Similarly, the problem

   Î± â‰… Î² (tt, x)

is erroneously pruned, despite having the solution

   Î² = Î» z. if z HD then tt else z TL.

Instead, the side condition should be strengthened to require not only
that fv^rig(s) âŠ„ V, but that one of the variables not in V occurs in a
"non-eliminateable" position (i.e. a position such that no instance of
the metavariable can project away the bad variable).

Lemma D.8 (Generality of pruning, page 248) is false as stated.  It
makes the assumption that fv^rig(t) âŠˆ V implies fv^rig(Î¸ t) âŠˆ V, which
is not the case for Î²-normal forms, because rigid free variables may
be eliminated by the combination of substitution for metavariables and
Î²-reduction (as in the above examples).

Thanks to Andreas Abel for pointing out this problem.  See also the
errata for "Higher-Order Dynamic Pattern Unification for Dependent
Types and Records" by Andreas Abel and Brigitte Pientka (2011) [1] and
a related bug in Agda [2].

[1] http://www.cse.chalmers.se/~abela/errata-tlca11.txt
[2] https://code.google.com/p/agda/issues/detail?id=458
